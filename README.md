# votes_kinopoisk_to_csv
# Парсер оценок Кинопоиска

## Описание

Этот Python-скрипт предназначен для сбора данных об оценках фильмов из профиля пользователя на сайте Кинопоиска (российская онлайн-база данных фильмов). Для автоматизации работы с браузером используется **Selenium**, а для парсинга HTML — **BeautifulSoup**. Скрипт извлекает информацию о названиях фильмов, рейтингах и оценках пользователя, сохраняя данные в CSV-файл для дальнейшего анализа.

## Возможности

- Авторизация в аккаунте Кинопоиска для доступа к странице с оценками пользователя.
- Сбор данных о фильмах, включая:
  - Название на русском и английском языках
  - Рейтинг Кинопоиска
  - Оценка пользователя
  - Дата выставления оценки
  - Ссылка на страницу фильма и его ID
- Обработка CAPTCHA с ручным подтверждением.
- Сохранение данных в CSV-файл с кодировкой UTF-8.
- Надежная обработка ошибок и логирование процесса парсинга.
- Поддержка пагинации для сбора данных с нескольких страниц.

## Требования

Для работы скрипта необходимы следующие зависимости:

- Python 3.6+
- `selenium` — для автоматизации браузера
- `webdriver_manager` — для автоматического управления ChromeDriver
- `beautifulsoup4` — для парсинга HTML
- `csv` — для сохранения данных в CSV (встроенный модуль)
- `logging` — для логирования (встроенный модуль)
- `urllib.parse` — для работы с URL (встроенный модуль)
- `re` — для работы с регулярными выражениями (встроенный модуль)

Установите зависимости с помощью pip:

```bash
pip install selenium webdriver_manager beautifulsoup4
```

Также необходимо:

- Установленный браузер **Google Chrome**.
- Действующий аккаунт на Кинопоиске (требуется ручная авторизация во время выполнения).

## Установка

1. Склонируйте или скачайте этот репозиторий на свой компьютер.
2. Убедитесь, что установлен Python 3.6+.
3. Установите зависимости:

```bash
pip install -r requirements.txt
```

(Можно создать файл `requirements.txt` со следующим содержимым:)

```
selenium
webdriver_manager
beautifulsoup4
```

4. Убедитесь, что браузер Google Chrome установлен.

## Использование

1. Запустите скрипт из командной строки:

```bash
python kinopoisk_parser.py
```

2. Введите URL страницы с оценками пользователя на Кинопоиске, например:

```
https://www.kinopoisk.ru/user/12345678/votes/
```

3. Следуйте инструкциям на экране:
   - Скрипт откроет окно браузера Chrome и перейдет на страницу входа в Кинопоиск.
   - Войдите в свой аккаунт Кинопоиска вручную (через Яндекс или другой поддерживаемый способ).
   - Перейдите на страницу с оценками и нажмите **Enter** в терминале, когда будете готовы.
   - Если появится CAPTCHA, решите её вручную в браузере и нажмите **Enter**, когда страница загрузится.

4. Скрипт соберет данные со всех доступных страниц с оценками и сохранит их в файл `kinopoisk_ratings.csv` в той же директории.

## Вывод

Результатом работы является CSV-файл (`kinopoisk_ratings.csv`) со следующими столбцами:

- **№**: Порядковый номер оценки.
- **Название (рус)**: Название фильма на русском.
- **Название (англ)**: Название фильма на английском.
- **Рейтинг КП**: Средний рейтинг фильма на Кинопоиске.
- **Оценка пользователя**: Личная оценка пользователя.
- **Дата оценки**: Дата, когда пользователь выставил оценку.
- **Ссылка**: URL страницы фильма на Кинопоиске.
- **ID фильма**: Идентификатор фильма на Кинопоиске.

Файл CSV использует кодировку UTF-8 с BOM (`utf-8-sig`) для корректного отображения кириллицы в программах, таких как Microsoft Excel.

## Логирование

Скрипт создает логи для отслеживания процесса и ошибок:

- Логи сохраняются в файл `kinopoisk_parser.log` в той же директории.
- Логи также выводятся в консоль.
- Записи логов содержат временные метки, уровни (INFO, WARNING, ERROR) и подробные сообщения.

Пример записи лога:

```
2025-04-12 10:00:00,123 - INFO - Обрабатываю страницу 1
2025-04-12 10:00:05,456 - INFO - Найдено 20 оценок
```

## Примечания

- **Ручное вмешательство**: Скрипт требует ручной авторизации и обработки CAPTCHA из-за мер безопасности Кинопоиска.
- **Ограничение скорости**: В скрипте используются задержки (`time.sleep()`), чтобы избежать перегрузки сервера и снизить вероятность блокировки.
- **Обработка ошибок**: Скрипт обрабатывает типичные проблемы, такие как отсутствие элементов, CAPTCHA или сетевые сбои, фиксируя их в логах.
- **Пагинация**: Скрипт останавливается после трех подряд пустых страниц, чтобы избежать бесконечного цикла.
- **Браузер**: Скрипт использует ChromeDriver, который автоматически управляется через `webdriver_manager`. Убедитесь, что Chrome установлен и обновлен.

## Ограничения

- Требуется ручная авторизация, так как автоматизированный вход может нарушать условия использования Кинопоиска.
- Обработка CAPTCHA выполняется вручную, что может прерывать автоматическую работу.
- Зависит от структуры сайта Кинопоиска; изменения в HTML могут нарушить работу скрипта.
- Скрипт собирает только общедоступные данные со страницы оценок пользователя.

## Устранение неполадок

- **Ошибки WebDriver**: Убедитесь, что Chrome установлен и совместим с версией ChromeDriver, управляемой `webdriver_manager`.
- **Проблемы с авторизацией**: Проверьте правильность учетных данных Кинопоиска и возможность входа вручную через браузер.
- **Циклы CAPTCHA**: Тщательно решайте CAPTCHA и убедитесь, что страница полностью загрузилась, прежде чем нажимать Enter.
- **Пустой вывод**: Проверьте корректность URL пользователя и наличие данных на странице с оценками.
- **Проблемы с кодировкой**: CSV использует `utf-8-sig` для поддержки кириллицы; используйте совместимый текстовый редактор или программу для работы с таблицами.

При возникновении проблем изучите файл `kinopoisk_parser.log` для получения подробных сообщений об ошибках.

## Вклад

Приветствуются любые улучшения! Пожалуйста, отправляйте pull request или создавайте issue для сообщений об ошибках, запросов новых функций или предложений по улучшению.

---

**Автор**: Никита Полежаев (golerton) 
**Последнее обновление**: 12 апреля 2025 г.
